{"slots":{"0":{"name":"slot1","type":{"events":[],"methods":[]}},"1":{"name":"slot2","type":{"events":[],"methods":[]}},"2":{"name":"slot3","type":{"events":[],"methods":[]}},"3":{"name":"slot4","type":{"events":[],"methods":[]}},"4":{"name":"slot5","type":{"events":[],"methods":[]}},"5":{"name":"slot6","type":{"events":[],"methods":[]}},"6":{"name":"slot7","type":{"events":[],"methods":[]}},"7":{"name":"slot8","type":{"events":[],"methods":[]}},"8":{"name":"slot9","type":{"events":[],"methods":[]}},"9":{"name":"slot10","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}},"-3":{"name":"player","type":{"events":[],"methods":[]}},"-2":{"name":"construct","type":{"events":[],"methods":[]}},"-4":{"name":"system","type":{"events":[],"methods":[]}},"-5":{"name":"library","type":{"events":[],"methods":[]}}},"handlers":[{"code":"local update_time = 1 --export\nlocal hubMass = 55.8\nlocal massFactor = 5 --export\nlocal screens = {}\nlocal core = nil\nlocal blinkIndicator = false\n\nlocal function initiateSlots()\n\tfor _, slot in pairs(unit) do\n\t\tif type(slot) == \"table\" and type(slot.export) == \"table\" and slot.getClass then\n\t\t\tlocal elementClass = slot.getClass():lower()\n\t\t\tif elementClass:find(\"coreunit\") then\n\t\t\t\tcore = slot\n\t\t\telseif elementClass == \"screenunit\" then\n\t\t\t\ttable.insert(screens,slot)\n\t\t\tend\n\t\tend\n\tend\n\t\n\tif not core then\n\t\terror(\"Core is not connected!\")\n\tend\n    \n\tif #screens < 1 then\n\t\terror(\"No screen connected!\")\n\tend\n\t\n\ttable.sort(screens, function (a, b) return (a.getLocalId() < b.getLocalId()) end)\nend\n\nlocal function getDataFromScreens()\n\tlocal dataFormScreens = {}\n\t\n\tfor i,screen in ipairs(screens) do\n\t\tdataFormScreens[i] = json.decode(screen.getScriptOutput())\n\tend\n\t\n\treturn dataFormScreens\nend\n\ninitiateSlots()\n\nlocal dataFormScreens = getDataFromScreens()\n\nfunction update()\n\tif blinkIndicator then blinkIndicator = false else blinkIndicator = true end\n\t\n\tfor i,screen in ipairs(screens) do\n\t\tif dataFormScreens[i] then\n\t\t\tlocal dataToSend = {}\n\t\t\tdataToSend.blinkIndicator = blinkIndicator\n\n\t\t\tfor _,id in pairs(dataFormScreens[i]) do\n\t\t\t\tdataToSend[id] = (core.getElementMassById(id) - hubMass)/(1 - massFactor * 0.05) \n\t\t\tend\n\n\t\t\tscreen.setScriptInput(json.encode(dataToSend))\n\t\tend \n\tend\nend\n\nfunction stop()\n\tfor i,screen in ipairs(screens) do\n\t\tscreen.setScriptInput(\"\")\n\tend\nend\n\n-------------------------\n-- UPDATE TIMER ------\n-------------------------\nunit.setTimer(\"update\", update_time)","filter":{"args":[],"signature":"onStart()","slotKey":"-1"},"key":"0"},{"code":"-------------------------\n-- FILTER UNIT STOP -----\n-------------------------\nstop()","filter":{"args":[],"signature":"onStop()","slotKey":"-1"},"key":"1"},{"code":"-------------------------\n-- FILTER UPDATE --------\n-------------------------\nupdate()","filter":{"args":[{"value":"update"}],"signature":"onTimer(tag)","slotKey":"-1"},"key":"2"}],"methods":[],"events":[]}
